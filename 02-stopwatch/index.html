<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Stopwatch</title>
    <style>
      /* ===================================
       CSS VARIABLES & THEME SETUP
       =================================== */

      /* Light mode theme (default) */
      :root {
        --bg-primary: #f5f5f7;
        --bg-secondary: #ffffff;
        --text-primary: #1d1d1f;
        --text-secondary: #86868b;
        --accent-color: #007aff;
        --accent-hover: #0051d5;
        --danger-color: #ff3b30;
        --danger-hover: #d32f2f;
        --success-color: #34c759;
        --border-color: #d2d2d7;
        --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        --lap-hover: #f0f0f5;
      }

      /* Dark mode theme - automatically applied based on system preference */
      @media (prefers-color-scheme: dark) {
        :root {
          --bg-primary: #000000;
          --bg-secondary: #1c1c1e;
          --text-primary: #f5f5f7;
          --text-secondary: #98989d;
          --accent-color: #0a84ff;
          --accent-hover: #409cff;
          --danger-color: #ff453a;
          --danger-hover: #ff6961;
          --success-color: #32d74b;
          --border-color: #38383a;
          --shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
          --lap-hover: #2c2c2e;
        }
      }

      /* ===================================
       BASE STYLES & RESET
       =================================== */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        transition: background 0.3s ease, color 0.3s ease;
      }

      /* ===================================
       MAIN CONTAINER LAYOUT
       =================================== */

      /* Main container uses CSS Grid for responsive layout */
      .container {
        width: 100%;
        max-width: 500px;
        background: var(--bg-secondary);
        border-radius: 24px;
        padding: 40px;
        box-shadow: var(--shadow);
        display: grid;
        gap: 32px;
        transition: background 0.3s ease, box-shadow 0.3s ease;
      }

      /* ===================================
       TIMER DISPLAY
       =================================== */

      /* Large, centered timer display */
      .timer {
        font-size: 56px;
        font-weight: 300;
        letter-spacing: -2px;
        text-align: center;
        font-variant-numeric: tabular-nums; /* Ensures consistent width for digits */
        user-select: none; /* Prevents accidental text selection */
      }

      /* ===================================
       BUTTON CONTROLS
       =================================== */

      /* Flexbox layout for button container */
      .controls {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* Base button styles - accessible and modern */
      button {
        flex: 1;
        min-width: 120px;
        padding: 16px 24px;
        font-size: 16px;
        font-weight: 500;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        color: white;
        font-family: inherit;
      }

      /* Button hover effects for better UX */
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* Active state for tactile feedback */
      button:active {
        transform: translateY(0);
      }

      /* Focus styles for keyboard navigation accessibility */
      button:focus {
        outline: 3px solid var(--accent-color);
        outline-offset: 2px;
      }

      /* Disabled state */
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      /* Primary action button (Start/Pause) */
      .btn-primary {
        background: var(--accent-color);
      }

      .btn-primary:hover:not(:disabled) {
        background: var(--accent-hover);
      }

      /* Success action button (Resume) */
      .btn-success {
        background: var(--success-color);
      }

      /* Danger action button (Reset) */
      .btn-danger {
        background: var(--danger-color);
      }

      .btn-danger:hover:not(:disabled) {
        background: var(--danger-hover);
      }

      /* Secondary action button (Lap) */
      .btn-secondary {
        background: var(--text-secondary);
      }

      /* ===================================
       LAP TIMES DISPLAY
       =================================== */

      /* Container for lap times list */
      .laps {
        display: none; /* Hidden by default until laps are recorded */
        max-height: 300px;
        overflow-y: auto;
        border-top: 1px solid var(--border-color);
        padding-top: 20px;
      }

      .laps.active {
        display: block;
      }

      /* Header for laps section */
      .laps h3 {
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-secondary);
        margin-bottom: 16px;
      }

      /* Individual lap item */
      .lap-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        margin-bottom: 8px;
        background: var(--bg-primary);
        border-radius: 8px;
        transition: background 0.2s ease;
        font-variant-numeric: tabular-nums;
      }

      .lap-item:hover {
        background: var(--lap-hover);
      }

      /* Lap number label */
      .lap-number {
        font-weight: 600;
        color: var(--text-secondary);
      }

      /* Lap time display */
      .lap-time {
        font-weight: 500;
        font-size: 18px;
      }

      /* Custom scrollbar for lap list (webkit browsers) */
      .laps::-webkit-scrollbar {
        width: 8px;
      }

      .laps::-webkit-scrollbar-track {
        background: var(--bg-primary);
        border-radius: 4px;
      }

      .laps::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
      }

      /* ===================================
       RESPONSIVE DESIGN
       =================================== */

      /* Tablet and smaller screens */
      @media (max-width: 600px) {
        .container {
          padding: 30px 20px;
        }

        .timer {
          font-size: 48px;
        }

        button {
          min-width: 100px;
          padding: 14px 20px;
          font-size: 15px;
        }
      }

      /* Mobile phones */
      @media (max-width: 400px) {
        .timer {
          font-size: 40px;
        }

        button {
          flex: 1 1 calc(50% - 6px);
          min-width: unset;
        }
      }
    </style>
  </head>
  <body>
    <!-- ===================================
       HTML STRUCTURE
       Semantic markup for accessibility
       =================================== -->

    <!-- Main application container -->
    <main class="container">
      <!-- Timer display with ARIA live region for screen readers -->
      <div class="timer" role="timer" aria-live="off" id="display">
        00:00:00:00
      </div>

      <!-- Control buttons with semantic button elements -->
      <div class="controls" role="group" aria-label="Stopwatch controls">
        <button id="startBtn" class="btn-primary" aria-label="Start stopwatch">
          Start
        </button>
        <button
          id="lapBtn"
          class="btn-secondary"
          disabled
          aria-label="Record lap time"
        >
          Lap
        </button>
        <button
          id="resetBtn"
          class="btn-danger"
          disabled
          aria-label="Reset stopwatch"
        >
          Reset
        </button>
      </div>

      <!-- Lap times section with semantic list -->
      <section class="laps" id="laps" aria-label="Lap times">
        <h3>Lap Times</h3>
        <div id="lapList" role="list"></div>
      </section>
    </main>

    <script>
      /* ===================================
       JAVASCRIPT - STOPWATCH LOGIC
       =================================== */

      // ============ DOM ELEMENTS ============
      // Cache DOM elements for better performance
      const display = document.getElementById("display");
      const startBtn = document.getElementById("startBtn");
      const lapBtn = document.getElementById("lapBtn");
      const resetBtn = document.getElementById("resetBtn");
      const lapsSection = document.getElementById("laps");
      const lapList = document.getElementById("lapList");

      // ============ STATE VARIABLES ============
      // Stopwatch state management
      let isRunning = false; // Whether stopwatch is currently running
      let isPaused = false; // Whether stopwatch is paused
      let startTime = 0; // Timestamp when stopwatch started (performance.now())
      let elapsedTime = 0; // Total elapsed time in milliseconds
      let animationId = null; // requestAnimationFrame ID for cleanup
      let laps = []; // Array to store lap times

      // ============ TIMING LOGIC ============

      /**
       * Formats milliseconds into HH:MM:SS:MS display format
       * @param {number} ms - Milliseconds to format
       * @returns {string} Formatted time string
       */
      function formatTime(ms) {
        // Extract time components
        const totalSeconds = Math.floor(ms / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        const milliseconds = Math.floor((ms % 1000) / 10); // Display centiseconds (2 digits)

        // Pad with leading zeros for consistent display
        return `${String(hours).padStart(2, "0")}:${String(minutes).padStart(
          2,
          "0"
        )}:${String(seconds).padStart(2, "0")}:${String(milliseconds).padStart(
          2,
          "0"
        )}`;
      }

      /**
       * Main update loop using requestAnimationFrame
       * This runs on every frame for smooth, accurate timing
       * Using performance.now() ensures high precision and prevents drift
       */
      function update() {
        if (!isRunning) return;

        // Calculate elapsed time since start
        // performance.now() provides microsecond precision
        const currentTime = performance.now();
        elapsedTime = currentTime - startTime;

        // Update display
        display.textContent = formatTime(elapsedTime);

        // Schedule next frame
        // requestAnimationFrame syncs with display refresh rate (~60fps)
        animationId = requestAnimationFrame(update);
      }

      // ============ CONTROL FUNCTIONS ============

      /**
       * Starts the stopwatch
       * Sets initial timestamp and begins animation loop
       */
      function start() {
        isRunning = true;
        isPaused = false;

        // Set start time, accounting for any previously elapsed time
        // This allows for accurate pause/resume functionality
        startTime = performance.now() - elapsedTime;

        // Update UI
        startBtn.textContent = "Pause";
        startBtn.className = "btn-primary";
        lapBtn.disabled = false;
        resetBtn.disabled = false;

        // Start the animation loop
        update();
      }

      /**
       * Pauses the stopwatch
       * Stops the animation loop and preserves elapsed time
       */
      function pause() {
        isRunning = false;
        isPaused = true;

        // Cancel animation frame to stop updates
        if (animationId) {
          cancelAnimationFrame(animationId);
        }

        // Update UI
        startBtn.textContent = "Resume";
        startBtn.className = "btn-success";
        lapBtn.disabled = true;
      }

      /**
       * Resets the stopwatch to initial state
       * Clears all timing data and lap records
       */
      function reset() {
        isRunning = false;
        isPaused = false;
        elapsedTime = 0;
        laps = [];

        // Cancel animation frame
        if (animationId) {
          cancelAnimationFrame(animationId);
        }

        // Reset display
        display.textContent = "00:00:00:00";

        // Reset UI
        startBtn.textContent = "Start";
        startBtn.className = "btn-primary";
        lapBtn.disabled = true;
        resetBtn.disabled = true;

        // Clear laps
        lapList.innerHTML = "";
        lapsSection.classList.remove("active");
      }

      /**
       * Records a lap time
       * Stores current elapsed time and updates lap display
       */
      function recordLap() {
        if (!isRunning) return;

        // Add current time to laps array
        laps.push(elapsedTime);

        // Create and insert lap item at the top (most recent first)
        const lapItem = document.createElement("div");
        lapItem.className = "lap-item";
        lapItem.setAttribute("role", "listitem");

        lapItem.innerHTML = `
        <span class="lap-number">Lap ${laps.length}</span>
        <span class="lap-time">${formatTime(elapsedTime)}</span>
      `;

        // Insert at the beginning for reverse chronological order
        lapList.insertBefore(lapItem, lapList.firstChild);

        // Show laps section
        lapsSection.classList.add("active");
      }

      // ============ EVENT LISTENERS ============

      /**
       * Start/Pause/Resume button handler
       * Toggles between start, pause, and resume states
       */
      startBtn.addEventListener("click", () => {
        if (!isRunning && !isPaused) {
          start();
        } else if (isRunning) {
          pause();
        } else if (isPaused) {
          start();
        }
      });

      /**
       * Lap button handler
       * Records current time as a lap
       */
      lapBtn.addEventListener("click", recordLap);

      /**
       * Reset button handler
       * Resets stopwatch to initial state
       */
      resetBtn.addEventListener("click", reset);

      // ============ KEYBOARD ACCESSIBILITY ============

      /**
       * Keyboard shortcuts for better accessibility
       * Space: Start/Pause/Resume
       * L: Record Lap
       * R: Reset
       */
      document.addEventListener("keydown", (e) => {
        // Prevent default only for our shortcuts
        if (e.code === "Space" && e.target === document.body) {
          e.preventDefault();
          startBtn.click();
        } else if (e.code === "KeyL" && !lapBtn.disabled) {
          e.preventDefault();
          lapBtn.click();
        } else if (e.code === "KeyR" && !resetBtn.disabled) {
          e.preventDefault();
          resetBtn.click();
        }
      });

      /* ===================================
       OPTIONAL: PERSISTENCE
       
       Uncomment this section to enable localStorage persistence
       This will save and restore the stopwatch state across sessions
       
       Note: The instructions mentioned localStorage as optional, so
       this code is provided but commented out by default
       =================================== */

      /*
    // Save state to localStorage
    function saveState() {
      const state = {
        elapsedTime,
        laps,
        isPaused
      };
      localStorage.setItem('stopwatch-state', JSON.stringify(state));
    }

    // Load state from localStorage
    function loadState() {
      const saved = localStorage.getItem('stopwatch-state');
      if (saved) {
        const state = JSON.parse(saved);
        elapsedTime = state.elapsedTime || 0;
        laps = state.laps || [];
        isPaused = state.isPaused || false;
        
        // Restore display
        display.textContent = formatTime(elapsedTime);
        
        // Restore laps
        if (laps.length > 0) {
          laps.forEach((lapTime, index) => {
            const lapItem = document.createElement('div');
            lapItem.className = 'lap-item';
            lapItem.innerHTML = `
              <span class="lap-number">Lap ${index + 1}</span>
              <span class="lap-time">${formatTime(lapTime)}</span>
            `;
            lapList.appendChild(lapItem);
          });
          lapsSection.classList.add('active');
        }
        
        // Restore UI state
        if (isPaused) {
          startBtn.textContent = 'Resume';
          startBtn.className = 'btn-success';
          resetBtn.disabled = false;
        }
      }
    }

    // Auto-save on state changes
    setInterval(() => {
      if (isRunning || isPaused) {
        saveState();
      }
    }, 1000);

    // Load state on page load
    loadState();
    */
    </script>
  </body>
</html>
